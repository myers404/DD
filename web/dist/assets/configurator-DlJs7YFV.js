var e,t,s,i,o,n,a,r,l,c,d,u,h,p,g,v,m,f,y,_,b,w,S,I,k,O,$,q,A,R,C,x,T,M,D,E,j,P,W,z,F,L,G,V,U,B=e=>{throw TypeError(e)},N=(e,t,s)=>t.has(e)||B("Cannot "+s),J=(e,t,s)=>(N(e,t,"read from private field"),s?s.call(e):t.get(e)),H=(e,t,s)=>t.has(e)?B("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),K=(e,t,s,i)=>(N(e,t,"write to private field"),i?i.call(e,s):t.set(e,s),s);import{g as Q,s as X,a as Y,p as Z,u as ee,b as te,f as se,i as ie,c as oe,t as ne,d as ae,e as re,h as le,j as ce,k as de,l as ue,o as he,m as pe,n as ge,q as ve,r as me,v as fe,w as ye,x as _e,y as be,z as we,A as Se,B as Ie,C as ke,D as Oe,E as $e,F as qe}from"./vendor-DQniMwO8.js";"undefined"!=typeof window&&((e=window.__svelte??(window.__svelte={})).v??(e.v=new Set)).add("5");class Ae{constructor(e,t={}){const s="localhost"===window.location.hostname&&"5173"===window.location.port?"/api/v1":"http://localhost:8080/api/v1";this.baseUrl=e||window.__API_BASE_URL__||s,this.modelId=t.modelId,this.authToken=t.authToken||localStorage.getItem("auth_token"),this.timeout=t.timeout||3e4,console.log("API Client initialized:",{baseUrl:this.baseUrl,modelId:this.modelId,hasAuth:!!this.authToken})}async request(e,t={}){const s=`${this.baseUrl}${e}`;console.log(`API Request: ${t.method||"GET"} ${s}`);const i={method:"GET",headers:{"Content-Type":"application/json",...this.authToken&&{Authorization:`Bearer ${this.authToken}`},...t.headers},...t};i.body&&"object"==typeof i.body&&(i.body=JSON.stringify(i.body));try{const t=new AbortController,n=setTimeout((()=>t.abort()),this.timeout),a=await fetch(s,{...i,signal:t.signal});if(clearTimeout(n),!a.ok){let t;try{t=await a.json()}catch(o){t={message:a.statusText}}const i=t.message||t.error||`HTTP ${a.status}`;console.error(`API Error Response from ${e}:`,{status:a.status,statusText:a.statusText,errorData:t,url:s});const n=new Error(i);throw n.status=a.status,n.data=t,n}const r=await a.json();return"localhost"!==window.location.hostname&&"127.0.0.1"!==window.location.hostname||console.log(`API Response from ${e}:`,r),r&&"object"==typeof r&&void 0!==r.success&&void 0!==r.data?r.data:r??(e.includes("/groups")||e.includes("/options")||e.includes("/rules")?[]:{})}catch(n){if("AbortError"===n.name)throw new Error("Request timeout");throw console.error(`API Error for ${e}:`,n),n}}async getModel(){if(!this.modelId)throw new Error("Model ID required");const e=await this.request(`/models/${this.modelId}`);return!e.option_groups&&e.groups&&(e.option_groups=e.groups),console.log("Model structure:",{hasGroups:!!e.groups,hasOptionGroups:!!e.option_groups,hasOptions:!!e.options,groupsCount:e.groups?.length||e.option_groups?.length||0,optionsCount:e.options?.length||0}),e}async getModelGroups(){if(!this.modelId)throw new Error("Model ID required");const e=await this.request(`/models/${this.modelId}/groups`);return Array.isArray(e)?e:[]}async getModelOptions(){if(!this.modelId)throw new Error("Model ID required");const e=await this.request(`/models/${this.modelId}/options`);return Array.isArray(e)?e:[]}async getModelRules(){if(!this.modelId)throw new Error("Model ID required");const e=await this.request(`/models/${this.modelId}/rules`);return Array.isArray(e)?e:[]}async getModelPricingRules(){if(!this.modelId)throw new Error("Model ID required");const e=await this.request(`/models/${this.modelId}/pricing-rules`);return Array.isArray(e)?e:[]}async getModelStatistics(){if(!this.modelId)throw new Error("Model ID required");return this.request(`/models/${this.modelId}/statistics`)}async createConfiguration(e=[]){return this.request("/configurations",{method:"POST",body:{model_id:this.modelId,name:`Configuration ${(new Date).toISOString()}`}})}async getConfiguration(e){return this.request(`/configurations/${e}?model_id=${this.modelId}`)}async updateConfiguration(e,t){return this.request(`/configurations/${e}`,{method:"PUT",body:{model_id:this.modelId,...t,selections:t.selections?this.formatSelections(t.selections):void 0}})}async deleteConfiguration(e){return this.request(`/configurations/${e}`,{method:"DELETE"})}async addSelections(e,t){return this.request(`/configurations/${e}/selections`,{method:"POST",body:{model_id:this.modelId,selections:this.formatSelections(t)}})}async removeSelection(e,t){return this.request(`/configurations/${e}/selections/${t}`,{method:"DELETE"})}async validateConfiguration(e){return this.request(`/configurations/${e}/validate?model_id=${this.modelId}`,{method:"POST",body:{model_id:this.modelId}})}async validateSelections(e){return this.request("/configurations/validate-selection",{method:"POST",body:{model_id:this.modelId,selections:this.formatSelections(e)}})}async getAvailableOptions(e){return this.request(`/configurations/${e}/available-options`)}async getConstraints(e){return this.request(`/configurations/${e}/constraints`)}async getConfigurationSummary(e){return this.request(`/configurations/${e}/summary`)}async cloneConfiguration(e){return this.request(`/configurations/${e}/clone`,{method:"POST"})}async calculatePrice(e,t={}){try{return await this.request("/pricing/calculate",{method:"POST",body:{model_id:this.modelId,selections:t.selections||[],customer_id:t.customer_id||null,context:t.context||{}}})}catch(s){throw console.error("Failed to calculate price:",s),s}}async simulatePricing(e){return this.request("/pricing/simulate",{method:"POST",body:{model_id:this.modelId,scenarios:e}})}async validatePricing(e,t){return this.request("/pricing/validate",{method:"POST",body:{model_id:this.modelId,selections:this.formatSelections(e),expected_price:t}})}async getPricingRules(){if(!this.modelId)throw new Error("Model ID required");return this.request(`/pricing/rules/${this.modelId}`)}async getVolumeTiers(){if(!this.modelId)throw new Error("Model ID required");return this.request(`/pricing/volume-tiers/${this.modelId}`)}async validateModel(){if(!this.modelId)throw new Error("Model ID required");return this.request(`/models/${this.modelId}/validate`,{method:"POST"})}async detectConflicts(e=[]){if(!this.modelId)throw new Error("Model ID required");return this.request(`/models/${this.modelId}/conflicts`,{method:"POST",body:{rule_ids:e}})}async analyzeImpact(e){if(!this.modelId)throw new Error("Model ID required");return this.request(`/models/${this.modelId}/impact`,{method:"POST",body:e})}async getModelQuality(){if(!this.modelId)throw new Error("Model ID required");return this.request(`/models/${this.modelId}/quality`,{method:"POST"})}async getOptimizationRecommendations(){if(!this.modelId)throw new Error("Model ID required");return this.request(`/models/${this.modelId}/optimize`,{method:"POST"})}formatSelections(e){return Array.isArray(e)?e:Object.entries(e).filter((([e,t])=>t>0)).map((([e,t])=>({option_id:e,quantity:parseInt(t)||1})))}async batchValidate(e){return this.request("/configurations/validate",{method:"POST",body:{configurations:e}})}async bulkCalculatePricing(e){return this.request("/pricing/bulk-calculate",{method:"POST",body:{configurations:e}})}async checkHealth(){return this.request("/health")}async getStatus(){return this.request("/status")}}function Re(e){if("string"!=typeof e)return!1;return["=>","function","$props","$","$.strict_equals","return ","${","() =>","} else","if (",".selection_type","strict_equals","min_selections","max_selections"].some((t=>e.includes(t)))}function Ce(e,t=""){if(null==e)return t;const s=String(e);return("string"!=typeof e||Re(s))&&Re(s)?(console.warn("[Sanitizer] Code pattern detected and removed:",{original:s.substring(0,100)+(s.length>100?"...":""),fallback:t}),t):s}function xe(e,t=["name","description","label","title","text","value"]){if(!e||"object"!=typeof e)return e;if(Array.isArray(e))return e.map((e=>xe(e,t)));const s={...e};return Object.keys(s).forEach((e=>{if("string"==typeof s[e]){const t=s[e],i=Ce(t,"");t!==i&&(console.warn(`[Sanitizer] Cleaned field '${e}' in object`),s[e]=i)}else s[e]&&"object"==typeof s[e]&&(s[e]=xe(s[e],t))})),s}t=new WeakMap,s=new WeakMap,i=new WeakMap,o=new WeakMap,n=new WeakMap,a=new WeakMap,r=new WeakMap,l=new WeakMap,c=new WeakMap,d=new WeakMap,u=new WeakMap,h=new WeakMap,p=new WeakMap,g=new WeakMap,v=new WeakMap,m=new WeakMap,f=new WeakMap,y=new WeakMap,_=new WeakMap,b=new WeakMap,w=new WeakMap,S=new WeakMap,I=new WeakMap,k=new WeakMap,O=new WeakMap;const Te=new class{constructor(){H(this,t),H(this,s),H(this,i),H(this,o),H(this,n),H(this,a),H(this,r),H(this,l),H(this,c),H(this,d),H(this,u),H(this,h),H(this,p),H(this,g),H(this,v),H(this,m),H(this,f),H(this,y),H(this,_),H(this,b),H(this,w),H(this,S),H(this,I),H(this,k),H(this,O),K(this,t,Y("")),K(this,s,Y(null)),K(this,i,Y(null)),K(this,o,Y(Z({}))),K(this,n,Y(null)),K(this,a,Y(null)),K(this,r,Y(Z([]))),K(this,l,Y(Z([]))),K(this,c,Y(Z([]))),K(this,d,Y(Z([]))),K(this,u,Y(Z([]))),K(this,h,Y(Z([]))),K(this,p,Y(Z([]))),K(this,g,Y(!1)),K(this,v,Y(!1)),K(this,m,Y(!1)),K(this,f,Y(!1)),K(this,y,Y(null)),K(this,_,Y(Z([]))),K(this,b,Y(null)),K(this,w,Y(null)),K(this,S,Y(!1)),K(this,I,Y(0)),K(this,k,Y(Z(new Set))),K(this,O,Y(Z(new Set))),this.api=null,this._initialized=!1,this._debounceTimers=new Map,this._modelLoaded=!1}get modelId(){return Q(J(this,t))}set modelId(e){X(J(this,t),e,!0)}get model(){return Q(J(this,s))}set model(e){X(J(this,s),e,!0)}get configuration(){return Q(J(this,i))}set configuration(e){X(J(this,i),e,!0)}get selections(){return Q(J(this,o))}set selections(e){X(J(this,o),e,!0)}get validationResults(){return Q(J(this,n))}set validationResults(e){X(J(this,n),e,!0)}get pricingData(){return Q(J(this,a))}set pricingData(e){X(J(this,a),e,!0)}get availableOptions(){return Q(J(this,r))}set availableOptions(e){X(J(this,r),e,!0)}get constraints(){return Q(J(this,l))}set constraints(e){X(J(this,l),e,!0)}get groups(){return Q(J(this,c))}set groups(e){X(J(this,c),e,!0)}get options(){return Q(J(this,d))}set options(e){X(J(this,d),e,!0)}get rules(){return Q(J(this,u))}set rules(e){X(J(this,u),e,!0)}get pricingRules(){return Q(J(this,h))}set pricingRules(e){X(J(this,h),e,!0)}get volumeTiers(){return Q(J(this,p))}set volumeTiers(e){X(J(this,p),e,!0)}get isLoading(){return Q(J(this,g))}set isLoading(e){X(J(this,g),e,!0)}get isValidating(){return Q(J(this,v))}set isValidating(e){X(J(this,v),e,!0)}get isPricing(){return Q(J(this,m))}set isPricing(e){X(J(this,m),e,!0)}get isSaving(){return Q(J(this,f))}set isSaving(e){X(J(this,f),e,!0)}get error(){return Q(J(this,y))}set error(e){X(J(this,y),e,!0)}get validationErrors(){return Q(J(this,_))}set validationErrors(e){X(J(this,_),e,!0)}get configurationId(){return Q(J(this,b))}set configurationId(e){X(J(this,b),e,!0)}get lastSaved(){return Q(J(this,w))}set lastSaved(e){X(J(this,w),e,!0)}get isDirty(){return Q(J(this,S))}set isDirty(e){X(J(this,S),e,!0)}get currentStep(){return Q(J(this,I))}set currentStep(e){X(J(this,I),e,!0)}get expandedGroups(){return Q(J(this,k))}set expandedGroups(e){X(J(this,k),e,!0)}get hiddenOptions(){return Q(J(this,O))}set hiddenOptions(e){X(J(this,O),e,!0)}async initialize(){this._initialized||(this._initialized=!0,console.log("🚀 ConfigurationStore initialized"),ee((()=>{this.modelId&&!this.api&&(this.api=new Ae(window.__API_BASE_URL__,{modelId:this.modelId}),this.loadModel())})),ee((()=>{this.configurationId&&this.selections&&Object.keys(this.selections).length>=0&&this._debounce("update",(()=>{this.updateSelectionsOnBackend()}),300)})))}get isValid(){return!this.validationResults||!this.validationResults.violations||0===this.validationResults.violations.length}get selectedCount(){return Object.values(this.selections).filter((e=>e>0)).length}get progress(){if(!this.model||!this.options)return 0;const e=this.groups.filter((e=>e.required)).length;if(0===e)return this.selectedCount>0?100:0;const t=this.groups.filter((e=>e.required)).filter((e=>this.hasGroupSelection(e.id))).length;return Math.round(t/e*100)}get totalPrice(){return this.pricingData?.total||this.pricingData?.breakdown?.total_price||0}get adjustments(){return this.pricingData?.breakdown?.adjustments||[]}get safeGroups(){return Array.isArray(this.groups)?this.groups:[]}get safeOptions(){return Array.isArray(this.options)?this.options:[]}async loadModel(){if(this.api&&this.modelId&&!this._modelLoaded){this.isLoading=!0,this.error=null;try{const e=await this.api.getModel(this.modelId);this.model=xe(e),this.groups=(e.groups||[]).filter((e=>!1!==e.is_active)),this.options=(e.options||[]).filter((e=>!1!==e.is_active)),this.rules=e.rules||[],this.pricingRules=e.pricing_rules||[],this.volumeTiers=e.volume_tiers||[],this.availableOptions=this.options.map((e=>({option:e,is_selectable:!0,reason:null}))),this._modelLoaded=!0,this.groups.slice(0,3).forEach((e=>this.expandedGroups.add(e.id)))}catch(e){console.error("Failed to load model:",e),this.error={message:e.message||"Failed to load model",code:e.code||"MODEL_LOAD_ERROR",details:e}}finally{this.isLoading=!1}}}async createConfiguration(){if(this.api&&!this.configurationId)try{const e=await this.api.createConfiguration({model_id:this.modelId,name:`Configuration ${(new Date).toISOString()}`});this.configuration=e,this.configurationId=e.id,this.selectedCount>0&&await this.updateSelectionsOnBackend()}catch(e){console.error("Failed to create configuration:",e),this.error={message:e.message||"Failed to create configuration",code:e.code||"CONFIG_CREATE_ERROR",details:e}}}async loadConfiguration(e){if(this.api){this.isLoading=!0;try{const t=await this.api.getConfiguration(e);this.configuration=t,this.configurationId=t.id,this.selections=t.selections||{},t.model_id&&t.model_id!==this.modelId&&(this.modelId=t.model_id,await this.loadModel()),await this.validateConfiguration(),await this.calculatePricing()}catch(t){console.error("Failed to load configuration:",t),this.error=t}finally{this.isLoading=!1}}}async saveConfiguration(){if(!this.api||!this.configurationId)return!1;this.isSaving=!0;try{return await this.api.updateConfiguration(this.configurationId,{selections:this.selections,status:"in_progress"}),this.lastSaved=new Date,this.isDirty=!1,!0}catch(e){return console.error("Failed to save configuration:",e),this.error=e,!1}finally{this.isSaving=!1}}updateSelection(e,t){if(!e)return;const s=t>0?1:0,i=this.options.find((t=>t.id===e));if(!i)return;const o=this.groups.find((e=>e.id===i.group_id));if(o){if(s>0&&this.availableOptions){const t=this.availableOptions.find((t=>t.option&&t.option.id===e||t.id===e));if(t){if("blocked"===t.status)return void console.warn(`Cannot select blocked option: ${i.name}`);if("switch"===t.status&&t.requires_deselect&&t.requires_deselect.length>0){console.log(`Switch operation for ${e}:`,t.requires_deselect);for(const e of t.requires_deselect)this.selections[e]&&(delete this.selections[e],console.log(`  - Deselected ${e}`))}if("max-reached"===t.status){const e=t.group_info||{};return void console.warn(`Cannot select - max selections (${e.max_selections||"unknown"}) reached for group ${o.name}`)}}}0===s?delete this.selections[e]:this.selections[e]=s,this.isDirty=!0,!this.configurationId&&this.selectedCount>0&&this.createConfiguration()}}async updateSelectionsOnBackend(){if(this.api&&this.configurationId)try{const e=await this.api.addSelections(this.configurationId,{selections:Object.entries(this.selections).map((([e,t])=>({option_id:e,quantity:t})))});e.configuration&&(this.configuration=e.configuration),e.validation_result&&(this.validationResults=e.validation_result,this.validationErrors=e.validation_result.violations||[]),e.available_options&&(this.availableOptions=e.available_options,this.checkAndDeselectInvalidOptions(e.available_options),this.checkAndApplyRequiredOptions(e.available_options),this.updateVisibleOptions()),this.isValid&&this.selectedCount>0&&this.configurationId?await this.calculatePricing():this.pricingData=null}catch(e){console.error("Failed to update selections:",e)}}async validateConfiguration(){if(this.api&&this.configurationId){this.isValidating=!0;try{const e=await this.api.validateConfiguration(this.configurationId),t=e.result||e;this.validationResults=t,this.validationErrors=t.violations||[],e.available_options&&(this.availableOptions=e.available_options)}catch(e){console.error("Configuration validation failed:",e)}finally{this.isValidating=!1}}}async calculatePricing(e={}){if(this.api&&this.configurationId&&!this.isPricing){this.isPricing=!0;try{const t=Object.entries(this.selections).filter((([e,t])=>t>0)).map((([e,t])=>({option_id:e,quantity:1}))),s=await this.api.calculatePrice(this.configurationId,{selections:t,...e});this.pricingData=s,console.log("Pricing data updated:",this.pricingData)}catch(t){console.error("Pricing calculation failed:",t),this.pricingData=null}finally{this.isPricing=!1}}}isGroupExpanded(e){return this.expandedGroups.has(e)}toggleGroup(e){this.expandedGroups.has(e)?this.expandedGroups.delete(e):this.expandedGroups.add(e),this.expandedGroups=new Set(this.expandedGroups)}hasGroupSelection(e){return this.safeOptions.filter((t=>t.group_id===e)).some((e=>this.selections[e.id]>0))}getGroupSelectionCount(e){return this.safeOptions.filter((t=>t.group_id===e)).filter((e=>this.selections[e.id]>0)).length}isOptionAvailable(e){if(!this.availableOptions||0===this.availableOptions.length)return!0;const t=this.availableOptions.find((t=>t.option&&t.option.id===e||t.id===e));return!t||(void 0!==t.status?"selectable"===t.status||"switch"===t.status||"selected"===t.status:!1!==t.is_selectable)}getOptionUnavailableReason(e){if(!this.availableOptions||0===this.availableOptions.length)return null;const t=this.availableOptions.find((t=>t.option&&t.option.id===e||t.id===e));return t?"blocked"===t.status&&t.blocked_by&&t.blocked_by.length>0?t.blocked_by[0].message||t.blocked_by[0].description:t&&!t.is_selectable?t.reason:null:null}getOptionConstraintInfo(e){if(!this.availableOptions||0===this.availableOptions.length)return null;const t=this.availableOptions.find((t=>t.option&&t.option.id===e||t.id===e));return t?{status:t.status||(!1===t.is_selectable?"blocked":"selectable"),canSelect:t.can_select||!1!==t.is_selectable,selectionMethod:t.selection_method||"add",requiresDeselect:t.requires_deselect||[],blockedBy:t.blocked_by||[],impact:t.impact||null,helpsResolve:t.helps_resolve||[],isRequired:t.is_required||!1,groupInfo:t.group_info||null}:null}getConstraintSummary(){const e={hasViolations:!1,blockedOptions:[],switchableOptions:[],helpfulOptions:[],violations:[],totalOptions:this.options.length,availableCount:0,blockedCount:0};if(this.validationResults&&this.validationResults.violations&&(e.hasViolations=this.validationResults.violations.length>0,e.violations=this.validationResults.violations.map((e=>({ruleId:e.rule_id,ruleName:e.rule_name,message:e.message,affectedOptions:e.affected_options||[]})))),this.availableOptions&&this.availableOptions.length>0)for(const t of this.availableOptions){const s=t.option||t,i={id:s.id,name:s.name,groupId:s.group_id};"blocked"===t.status?(e.blockedCount++,e.blockedOptions.push({...i,reasons:t.blocked_by||[]})):"switch"===t.status?(e.switchableOptions.push({...i,requiresDeselect:t.requires_deselect||[]}),e.availableCount++):"selectable"!==t.status&&"selected"!==t.status||e.availableCount++,"helps"===t.impact&&t.helps_resolve&&t.helps_resolve.length>0&&e.helpfulOptions.push({...i,helpsResolve:t.helps_resolve,impact:t.impact})}return e}checkAndDeselectInvalidOptions(e){let t=!1;if(Array.isArray(e))for(const s of e){const e=s.option||s,i=e.id,o="blocked"===s.status||void 0===s.status&&!1===s.is_selectable;if(this.selections[i]&&o){delete this.selections[i],t=!0;let o=[];s.blocked_by&&s.blocked_by.length>0?o=s.blocked_by.map((e=>e.message||e.description||e.type)):s.reason&&(o=[s.reason]);const n=o.length>0?o.join(", "):"Constraint violation";console.log(`Auto-deselected blocked option: ${e.name} (${i}) - Reason: ${n}`)}}return t&&(this.isDirty=!0),t}checkAndApplyRequiredOptions(e){let t=!1;if(Array.isArray(e))for(const s of e){const e=s.option||s,i=e.id;if(s.is_required&&!this.selections[i]){const s=this.groups.find((t=>t.id===e.group_id));if(s&&"single"===s.selection_type){this.options.filter((e=>e.group_id===s.id)).forEach((e=>{e.id!==i&&this.selections[e.id]&&delete this.selections[e.id]}))}this.selections[i]=1,t=!0,console.log(`Auto-selected required option: ${e.name} (${i})`)}}t&&(this.isDirty=!0)}evaluateRuleCondition(e){if(!e.expression)return!1;return(e.expression.match(/\b(opt_\w+|cpu_\w+|ram_\w+|storage_\w+)\b/g)||[]).some((e=>this.selections[e]>0))}extractRequiredOptions(e){if(!e.expression)return[];const t=e.expression.indexOf("THEN");if(-1===t)return[];return e.expression.substring(t+4).match(/\b(opt_\w+|cpu_\w+|ram_\w+|storage_\w+)\b/g)||[]}exportConfiguration(){return{id:this.configurationId,model_id:this.modelId,selections:this.selections,validation:{is_valid:this.isValid,violations:this.validationErrors},pricing:{total_price:this.totalPrice,adjustments:this.adjustments,breakdown:this.pricingData?.breakdown||null,currency:this.pricingData?.currency||"USD"},metadata:{created:this.configuration?.created_at,updated:this.configuration?.updated_at,saved:this.lastSaved}}}updateVisibleOptions(){if(this.availableOptions&&0!==this.availableOptions.length){this.hiddenOptions=new Set;for(const e of this.options){const t=this.availableOptions.find((t=>t.option&&t.option.id===e.id||t.id===e.id));if(t){("blocked"===t.status||void 0===t.status&&!1===t.is_selectable)&&!this.selections[e.id]&&this.hiddenOptions.add(e.id)}}}else this.hiddenOptions=new Set}isOptionVisible(e){return!this.hiddenOptions||!this.hiddenOptions.has(e)}clearSelections(){this.selections={},this.isDirty=!0,this.validationResults=null,this.pricingData=null,this.configurationId&&(this.validateConfiguration(),this.calculatePricing())}reset(){this.selections={},this.validationResults=null,this.pricingData=null,this.configuration=null,this.configurationId=null,this.currentStep=0,this.isDirty=!1,this.error=null,this.validationErrors=[],this.hiddenOptions=new Set}_debounce(e,t,s){clearTimeout(this._debounceTimers.get(e)),this._debounceTimers.set(e,setTimeout(t,s))}setModelId(e){this.modelId!==e&&(this.reset(),this.modelId=e,this._modelLoaded=!1)}};class Me{constructor(e,t={}){let s;if("undefined"!=typeof window){s="localhost"===window.location.hostname&&"5173"===window.location.port?"/api/v2":"http://localhost:8080/api/v2"}else s="http://localhost:8080/api/v2";this.baseUrl=e||window.__API_BASE_URL__?.replace("/v1","/v2")||s,this.modelId=t.modelId,this.authToken=t.authToken||localStorage.getItem("auth_token"),this.sessionToken=t.sessionToken||localStorage.getItem("session_token"),this.sessionId=t.sessionId||localStorage.getItem("session_id"),this.timeout=t.timeout||3e4,console.log("Session API Client initialized:",{baseUrl:this.baseUrl,modelId:this.modelId,hasAuth:!!this.authToken,hasSession:!!this.sessionId})}async request(e,t={}){const s=`${this.baseUrl}${e}`;console.log(`Session API Request: ${t.method||"GET"} ${s}`);const i={method:"GET",headers:{"Content-Type":"application/json",...this.authToken&&{Authorization:`Bearer ${this.authToken}`},...this.sessionToken&&{"X-Session-Token":this.sessionToken},...t.headers},...t};i.body&&"object"==typeof i.body&&(i.body=JSON.stringify(i.body));try{const t=new AbortController,n=setTimeout((()=>t.abort()),this.timeout),a=await fetch(s,{...i,signal:t.signal});if(clearTimeout(n),!a.ok){let t;try{t=await a.json()}catch(o){t={message:a.statusText}}const i=t.message||t.error||`HTTP ${a.status}`;console.error(`Session API Error Response from ${e}:`,{status:a.status,statusText:a.statusText,errorData:t,url:s});const n=new Error(i);throw n.status=a.status,n.data=t,n}const r=await a.json();return"localhost"!==window.location.hostname&&"127.0.0.1"!==window.location.hostname||console.log(`Session API Response from ${e}:`,r),r&&"object"==typeof r&&void 0!==r.success&&void 0!==r.data?r.data:r??{}}catch(n){if("AbortError"===n.name)throw new Error("Request timeout");throw console.error(`Session API Error for ${e}:`,n),n}}async createSession(e=null){const t=await this.request("/configurations",{method:"POST",body:{model_id:e||this.modelId,name:`Configuration ${(new Date).toISOString()}`,description:"New configuration session"}});return t.session_id&&(this.sessionId=t.session_id,localStorage.setItem("session_id",t.session_id)),t.session_token&&(this.sessionToken=t.session_token,localStorage.setItem("session_token",t.session_token)),t}async getSession(e=null){const t=e||this.sessionId;if(!t)throw new Error("Session ID required");return this.request(`/configurations/${t}`)}async updateSession(e,t=null){const s=t||this.sessionId;if(!s)throw new Error("Session ID required");return this.request(`/configurations/${s}`,{method:"PUT",body:e})}async updateSelections(e,t=null){const s=t||this.sessionId;if(!s)throw new Error("Session ID required");return this.request(`/configurations/${s}`,{method:"PUT",body:{selections:this.formatSelections(e)}})}async addSelections(e,t=null){const s=t||this.sessionId;if(!s)throw new Error("Session ID required");return this.request(`/configurations/${s}/selections`,{method:"POST",body:{selections:this.formatSelections(e)}})}async validateSession(e=null){const t=e||this.sessionId;if(!t)throw new Error("Session ID required");return this.request(`/configurations/${t}/validate`,{method:"POST"})}async calculatePrice(e=null){const t=e||this.sessionId;if(!t)throw new Error("Session ID required");return this.request(`/configurations/${t}/price`,{method:"POST"})}async completeSession(e=null){const t=e||this.sessionId;if(!t)throw new Error("Session ID required");return this.request(`/configurations/${t}/complete`,{method:"POST"})}async extendSession(e=30,t=null){const s=t||this.sessionId;if(!s)throw new Error("Session ID required");return this.request(`/configurations/${s}/extend`,{method:"POST",body:{days:e}})}async getUserSessions(){return this.request("/configurations/user-sessions")}async getModel(e=null){const t=e||this.modelId;if(!t)throw new Error("Model ID required");const s=await this.request(`/models/${t}`);return!s.option_groups&&s.groups&&(s.option_groups=s.groups),s}async getModelGroups(e=null){const t=e||this.modelId;if(!t)throw new Error("Model ID required");const s=await this.request(`/models/${t}/groups`);if(s&&"object"==typeof s){if(s.groups&&Array.isArray(s.groups))return s.groups;if(s.data&&s.data.groups&&Array.isArray(s.data.groups))return s.data.groups}return Array.isArray(s)?s:[]}async getModelOptions(e=null){const t=e||this.modelId;if(!t)throw new Error("Model ID required");const s=await this.request(`/models/${t}/options`);if(s&&"object"==typeof s){if(s.options&&Array.isArray(s.options))return s.options;if(s.data&&s.data.options&&Array.isArray(s.data.options))return s.data.options}return Array.isArray(s)?s:[]}async getModelRules(e=null){const t=e||this.modelId;if(!t)throw new Error("Model ID required");const s=await this.request(`/models/${t}/rules`);if(s&&"object"==typeof s){if(s.rules&&Array.isArray(s.rules))return s.rules;if(s.data&&s.data.rules&&Array.isArray(s.data.rules))return s.data.rules}return Array.isArray(s)?s:[]}formatSelections(e){return Array.isArray(e)?e:Object.entries(e).filter((([e,t])=>t>0)).map((([e,t])=>({option_id:e,quantity:parseInt(t)||1})))}async recoverSession(){const e=localStorage.getItem("session_id"),t=localStorage.getItem("session_token");if(!e)return null;try{const s=await this.getSession(e);if(s&&"abandoned"!==s.status&&new Date(s.expires_at)>new Date)return this.sessionId=e,this.sessionToken=t,s}catch(s){404===s.status?console.log("Session not found, will create new one"):console.error("Failed to recover session:",s)}return this.clearSession(),null}clearSession(){this.sessionId=null,this.sessionToken=null,localStorage.removeItem("session_id"),localStorage.removeItem("session_token")}async checkHealth(){return this.request("/health")}async getStatus(){return this.request("/status")}}class De{constructor(){H(this,$),H(this,q),H(this,A),H(this,R),H(this,C),H(this,x),H(this,T),H(this,M),H(this,D),H(this,E),H(this,j),H(this,P),H(this,W),H(this,z),H(this,F),H(this,L),H(this,G),H(this,V),H(this,U),K(this,$,Y(null)),K(this,q,Y(null)),K(this,A,Y(null)),K(this,R,Y("draft")),K(this,C,Y(null)),K(this,x,Y(null)),K(this,T,Y(null)),K(this,M,Y(null)),K(this,D,Y(null)),K(this,E,Y(Z({}))),K(this,j,Y(null)),K(this,P,Y(null)),K(this,W,Y(null)),K(this,z,Y(null)),K(this,F,Y(!1)),K(this,L,Y(!1)),K(this,G,Y(null)),K(this,V,Y(null)),K(this,U,Y(!1)),this.api=null}get modelId(){return Q(J(this,$))}set modelId(e){X(J(this,$),e,!0)}get sessionId(){return Q(J(this,q))}set sessionId(e){X(J(this,q),e,!0)}get sessionToken(){return Q(J(this,A))}set sessionToken(e){X(J(this,A),e,!0)}get sessionStatus(){return Q(J(this,R))}set sessionStatus(e){X(J(this,R),e,!0)}get expiresAt(){return Q(J(this,C))}set expiresAt(e){X(J(this,C),e,!0)}get model(){return Q(J(this,x))}set model(e){X(J(this,x),e,!0)}get groups(){return Q(J(this,T))}set groups(e){X(J(this,T),e,!0)}get options(){return Q(J(this,M))}set options(e){X(J(this,M),e,!0)}get rules(){return Q(J(this,D))}set rules(e){X(J(this,D),e,!0)}get selections(){return Q(J(this,E))}set selections(e){X(J(this,E),e,!0)}get configuration(){return Q(J(this,j))}set configuration(e){X(J(this,j),e,!0)}get validationResult(){return Q(J(this,P))}set validationResult(e){X(J(this,P),e,!0)}get pricingResult(){return Q(J(this,W))}set pricingResult(e){X(J(this,W),e,!0)}get availableOptions(){return Q(J(this,z))}set availableOptions(e){X(J(this,z),e,!0)}get isLoading(){return Q(J(this,F))}set isLoading(e){X(J(this,F),e,!0)}get isSaving(){return Q(J(this,L))}set isSaving(e){X(J(this,L),e,!0)}get error(){return Q(J(this,G))}set error(e){X(J(this,G),e,!0)}get lastSaved(){return Q(J(this,V))}set lastSaved(e){X(J(this,V),e,!0)}get isDirty(){return Q(J(this,U))}set isDirty(e){X(J(this,U),e,!0)}async initialize(e,t={}){this.modelId=e;const s=t.apiUrl||("localhost"===window.location.hostname&&"5173"===window.location.port?"/api/v2":"http://localhost:8080/api/v2");this.api=new Me(s,{modelId:e,authToken:t.authToken,timeout:t.timeout||3e4});await this.recoverSession()||await this.createSession(),await new Promise((e=>setTimeout(e,50))),await this.loadModel(),await new Promise((e=>setTimeout(e,50)))}async createSession(){if(this.api&&this.modelId)try{this.isLoading=!0;const e=await this.api.createSession(this.modelId);if(console.log("Create session response:",e),this.sessionId=e.session_id,this.sessionToken=e.session_token,this.sessionStatus=e.status,this.expiresAt=e.expires_at,this.configuration=e,e.selections&&Array.isArray(e.selections)){console.log("Applying selections from response:",e.selections);const t={};for(const s of e.selections){const e=s.option_id||s.OptionID,i=s.quantity||s.Quantity||1;e&&(t[e]=i)}this.selections={...t},console.log("Updated this.selections to:",this.selections),console.log("Store selections state after update:",JSON.stringify(this.selections))}else console.log("No selections in create session response"),console.log("Result keys:",Object.keys(e)),console.log("Full result:",JSON.stringify(e,null,2));this.validationResult=e.validation_state||null,this.pricingResult=e.pricing_state||null,console.log("Session created:",{sessionId:this.sessionId,status:this.sessionStatus,expiresAt:this.expiresAt,selections:this.selections,isValid:e.is_valid,totalPrice:e.total_price})}catch(e){console.error("Failed to create session:",e),this.error={message:e.message||"Failed to create session",code:e.code||"SESSION_CREATE_ERROR",details:e}}finally{this.isLoading=!1}}async recoverSession(){if(!this.api)return!1;try{const e=await this.api.recoverSession();if(e){if(console.log("Recovering session:",e),this.sessionId=e.session_id||e.id,this.sessionToken=e.session_token,this.sessionStatus=e.status,this.expiresAt=e.expires_at,this.configuration=e,Array.isArray(e.selections)){const t={};for(const s of e.selections){const e=s.option_id||s.OptionID,i=s.quantity||s.Quantity||1;e&&(t[e]=i)}this.selections=t}else this.selections={...e.selections||{}};return this.validationResult=e.validation_state,this.pricingResult=e.pricing_state,console.log("Session recovered:",{sessionId:this.sessionId,status:this.sessionStatus,selectionsCount:Object.keys(this.selections).length,selections:this.selections}),!0}}catch(e){console.error("Failed to recover session:",e)}return!1}async loadModel(){if(this.api&&this.modelId){this.isLoading=!0;try{const[e,t,s,i]=await Promise.all([this.api.getModel(),this.api.getModelGroups(),this.api.getModelOptions(),this.api.getModelRules()]);this.model=e,this.groups=Array.isArray(t)?t:[],this.options=Array.isArray(s)?s:[],this.rules=Array.isArray(i)?i:[],console.log("Model loaded:",{modelId:this.modelId,groupsCount:this.groups.length,optionsCount:this.options.length,rulesCount:this.rules.length,groups:this.groups,currentSelections:this.selections,selectionsKeys:Object.keys(this.selections)}),console.log("Groups with defaults:"),this.groups.forEach((e=>{if(e.default_option_id){const t=this.selections[e.default_option_id]>0;console.log(`  - ${e.name}: default = ${e.default_option_id}, selected = ${t}`)}}))}catch(e){console.error("Failed to load model:",e),this.error={message:e.message||"Failed to load model",code:e.code||"MODEL_LOAD_ERROR",details:e}}finally{this.isLoading=!1}}}updateSelection(e,t){if(!e)return;const s=t>0?1:0,i=this.options.find((t=>t.id===e));if(!i)return;const o=this.groups.find((e=>e.id===i.group_id));if(!o)return;console.log(`updateSelection called: ${i.name} (${e}) = ${s}, Group: ${o.name}`);const n="single"===o.selection_type||"single_required"===o.selection_type||"radio"===o.selection_type||"dropdown"===o.selection_type||"single-select"===o.type||"single"===o.type,a={...this.selections};if(n&&s>0){this.options.filter((e=>e.group_id===o.id)).forEach((t=>{t.id!==e&&a[t.id]&&(console.log(`Clearing previous selection: ${t.name} from group ${o.name}`),delete a[t.id])}))}s>0?a[e]=s:delete a[e],this.selections=a,this.isDirty=!0,this.updateTimeout&&clearTimeout(this.updateTimeout),this.updateTimeout=setTimeout((()=>{this.updateSelectionsOnBackend()}),300)}async updateSelectionsOnBackend(){if(this.api&&this.sessionId)try{const e=Object.entries(this.selections).filter((([e,t])=>t>0)).map((([e,t])=>({option_id:e,quantity:parseInt(t)||1})));console.log("Sending selections to backend:",e);const t=await this.api.updateSelections(e);if(this.configuration=t.configuration||t.updated_config,this.validationResult=t.validation_result,this.pricingResult=t.price_breakdown,this.availableOptions=Array.isArray(t.available_options)?t.available_options:[],this.configuration&&this.configuration.selections){const e={};for(const t of this.configuration.selections)e[t.option_id]=t.quantity;console.log("Syncing selections - Before:",this.selections),console.log("Syncing selections - After:",e),this.selections={...e},console.log("Validation result:",this.validationResult),console.log("Available options with impact:",this.availableOptions?.slice(0,5).map((e=>({name:e.option?.name||e.name,impact:e.impact,helps:e.helps_resolve,is_selectable:e.is_selectable})))),this.selections=e}this.lastSaved=new Date,this.isDirty=!1,console.log("Session updated:",{sessionId:this.sessionId,selectionsCount:e.length,isValid:this.validationResult?.is_valid,totalPrice:this.pricingResult?.total_price,fullResult:t,configIsValid:this.configuration?.is_valid})}catch(e){console.error("Failed to update session:",e),this.error={message:e.message||"Failed to update selections",code:e.code||"UPDATE_ERROR",details:e}}}checkAndDeselectInvalidOptions(e){let t=!1;if(Array.isArray(e))for(const s of e){const e=s.option||s,i=e.id;this.selections[i]&&!1===s.is_selectable&&(delete this.selections[i],t=!0,console.log(`Auto-deselected invalid option: ${e.name} (${i})`))}return t&&(this.isDirty=!0),t}async validateConfiguration(){if(this.api&&this.sessionId)try{const e=await this.api.validateSession();return this.validationResult=e,e}catch(e){console.error("Failed to validate session:",e),this.error=e}}async calculatePricing(){if(this.api&&this.sessionId)try{const e=await this.api.calculatePrice();return this.pricingResult=e.breakdown||e,e}catch(e){console.error("Failed to calculate price:",e),this.error=e}}async completeSession(){if(this.api&&this.sessionId)try{const e=await this.api.completeSession();return this.sessionStatus="completed",e}catch(e){console.error("Failed to complete session:",e),this.error=e}}async extendSession(e=30){if(this.api&&this.sessionId)try{const t=await this.api.extendSession(e);return t.expires_at&&(this.expiresAt=t.expires_at),t}catch(t){console.error("Failed to extend session:",t),this.error=t}}get selectedOptions(){return Object.entries(this.selections).filter((([e,t])=>t>0)).map((([e])=>this.options.find((t=>t.id===e)))).filter(Boolean)}get selectedCount(){return Object.keys(this.selections).filter((e=>this.selections[e]>0)).length}get totalPrice(){return this.pricingResult?.total_price||0}get isValid(){return this.validationResult&&"boolean"==typeof this.validationResult.is_valid?this.validationResult.is_valid:0===this.selectedCount}get violations(){return this.validationResult?.violations||[]}get hasActiveViolations(){return this.violations.some((e=>"error"===e.severity||"Error"===e.severity))}get sessionTimeRemaining(){if(!this.expiresAt)return null;const e=new Date,t=new Date(this.expiresAt)-e;if(t<=0)return"Expired";const s=Math.floor(t/864e5),i=Math.floor(t%864e5/36e5);return s>0?`${s} days`:`${i} hours`}reset(){this.selections={},this.validationResult=null,this.pricingResult=null,this.availableOptions=[],this.isDirty=!1,this.error=null}clearError(){this.error=null}clearSession(){this.api&&this.api.clearSession(),this.sessionId=null,this.sessionToken=null,this.sessionStatus="draft",this.expiresAt=null,this.reset()}}$=new WeakMap,q=new WeakMap,A=new WeakMap,R=new WeakMap,C=new WeakMap,x=new WeakMap,T=new WeakMap,M=new WeakMap,D=new WeakMap,E=new WeakMap,j=new WeakMap,P=new WeakMap,W=new WeakMap,z=new WeakMap,F=new WeakMap,L=new WeakMap,G=new WeakMap,V=new WeakMap,U=new WeakMap;var Ee=se('<p class="loading-message svelte-cmfdh2"> </p>'),je=se('<div><div class="spinner svelte-cmfdh2"></div> <!></div>');function Pe(e,t){let s=te(t,"size",3,"medium"),i=te(t,"message",3,"");var o=je();let n;var a=oe(re(o),2),r=e=>{var t=Ee(),s=re(t);ne((()=>le(s,i()))),ae(e,t)};ie(a,(e=>{i()&&e(r)})),ne((e=>n=ce(o,1,"loading-spinner svelte-cmfdh2",null,n,e)),[()=>({small:"small"===s(),large:"large"===s()})]),ae(e,o)}var We=()=>location.reload(),ze=se('<div class="error-boundary svelte-szpq5s"><div class="error-content svelte-szpq5s"><div class="error-icon svelte-szpq5s">⚠️</div> <h2 class="error-title svelte-szpq5s">Something went wrong</h2> <p class="error-message svelte-szpq5s"> </p> <!> <div class="error-actions svelte-szpq5s"><button class="btn btn-primary svelte-szpq5s">Try Again</button> <button class="btn btn-secondary svelte-szpq5s">Reload Page</button></div></div></div>');de(["click"]);var Fe=se('<div><div class="tooltip-content svelte-1b7e63k"> </div> <div class="tooltip-arrow svelte-1b7e63k"></div></div>'),Le=se('<div class="tooltip-wrapper svelte-1b7e63k"><!> <!></div>');function Ge(e,t){let s,i,o,n=te(t,"content",3,""),a=te(t,"position",3,"top"),r=te(t,"delay",3,100),l=te(t,"maxWidth",3,"400px"),c=Y(!1);var d=Le(),u=re(d);fe(u,t,"default",{});var h=oe(u,2),p=e=>{var t=Fe(),i=re(t),o=re(i);ye(t,(e=>s=e),(()=>s)),ne((()=>{ce(t,1,`tooltip ${a()??""}`,"svelte-1b7e63k"),be(t,`max-width: ${l()??""}; min-width: 200px;`),le(o,n())})),ae(e,t)};ie(h,(e=>{Q(c)&&n()&&e(p)})),ye(d,(e=>i=e),(()=>i)),_e("mouseenter",d,(function(){o=setTimeout((()=>{X(c,!0)}),r())})),_e("mouseleave",d,(function(){clearTimeout(o),X(c,!1)})),ae(e,d)}function Ve(e,t,s,i,o,n){if("switch"===t()&&"single"===s())i.onChange(1);else{if("blocked"===t())return void e.preventDefault();if("single"===s())i.onChange(1);else{if(o()&&n())return void e.preventDefault();i.onChange(o()?0:1)}}}var Ue=se('<span class="price svelte-1hikx0i"> </span>'),Be=se(" <!>",1),Ne=se('<span class="price svelte-1hikx0i"> </span>'),Je=se(' <!> <span class="requirement-hint svelte-1hikx0i">ℹ️</span>',1),He=se('<span class="price svelte-1hikx0i"> </span>'),Ke=se(" <!>",1),Qe=se('<span class="badge-required svelte-1hikx0i">[Required]</span>'),Xe=se("<span> </span>"),Ye=se('<div class="constraint-reason svelte-1hikx0i"> </div>'),Ze=se('<div><label><input class="option-input svelte-1hikx0i"/> <span><!> <!> <!></span></label> <!></div>');de(["change"]);var et=se('<span class="required svelte-1m3fy32">*</span>'),tt=se('<p class="selection-info svelte-1m3fy32"><!> <!></p>'),st=se('<div><div class="group-header svelte-1m3fy32"><h3 class="group-title svelte-1m3fy32"> <!></h3> <!></div> <div class="options-container svelte-1m3fy32"></div></div>');function it(e,t){ue(t,!0);let s=te(t,"options",19,(()=>[])),i=te(t,"selections",19,(()=>({}))),o=te(t,"availableOptions",19,(()=>[]));te(t,"validationResults",3,null);const n="single"===t.group?.selection_type||"single-select"===t.group?.selection_type||"single-select"===t.group?.type||"single"===t.group?.type;ee((()=>{t.group?.default_option_id&&console.log(`OptionGroup ${t.group.name}:`,{defaultOptionId:t.group.default_option_id,selections:i(),selectionsType:typeof i(),isArray:Array.isArray(i()),defaultSelected:i()&&i()[t.group.default_option_id]>0,selectionsKeys:i()?Object.keys(i()):[],selectionsJSON:JSON.stringify(i())})}));const a=we((()=>s().filter((e=>i()&&i()[e.id]>0)).length));var r=st();let l;var c=re(r),d=re(c),u=re(d),h=oe(u),p=e=>{var t=et();ae(e,t)};ie(h,(e=>{t.group.is_required&&e(p)}));var g=oe(d,2),v=e=>{var s=tt(),i=re(s),o=e=>{var s=Oe();ne((()=>le(s,`Select ${t.group.min_selections??""} to ${t.group.max_selections??""}`))),ae(e,s)},n=(e,s)=>{var i=e=>{var s=Oe();ne((()=>le(s,`Select at least ${t.group.min_selections??""}`))),ae(e,s)},o=(e,s)=>{var i=e=>{var s=Oe();ne((()=>le(s,`Select up to ${t.group.max_selections??""}`))),ae(e,s)};ie(e,(e=>{t.group.max_selections&&e(i)}),s)};ie(e,(e=>{t.group.min_selections?e(i):e(o,!1)}),s)};ie(i,(e=>{t.group.min_selections&&t.group.max_selections?e(o):e(n,!1)}));var r=oe(i,2),l=e=>{var t=Oe();ne((()=>le(t,`(${Q(a)??""} selected)`))),ae(e,t)};ie(r,(e=>{Q(a)>0&&e(l)})),ae(e,s)};ie(g,(e=>{(t.group.min_selections||t.group.max_selections)&&e(v)}));var m=oe(c,2);ke(m,21,s,(e=>e.id),((e,a)=>{const r=we((()=>function(e){const s=i()&&(i()[e.id]||0)>0;e.id===t.group?.default_option_id&&console.log(`getOptionState for default ${e.id}:`,{selections:i(),selectionValue:i()?i()[e.id]:void 0,selected:s});let n=!0,a=null,r=!1,l=null,c=[],d="selectable",u=[],h=[],p=!0,g="add",v=null;if(Array.isArray(o())&&o().length>0){const t=o()[0];if(t&&"object"==typeof t&&"is_selectable"in t){const t=o().find((t=>t.option&&t.option.id===e.id||t.id===e.id));t&&(t.status?(d=t.status,p=t.can_select||!1,g=t.selection_method||"none",u=t.requires_deselect||[],h=t.blocked_by||[],n="blocked"!==d,a=h.length>0?h[0].message||h[0].description||t.reason:t.reason||null):(n=!1!==t.is_selectable,a=t.reason||null),r=!0===t.is_required,l=t.impact||null,c=t.helps_resolve||[],v=t.requirement_tooltip||null,o().indexOf(t)<3&&console.log(`Option ${e.name}:`,{status:t.status,impact:t.impact,helps_resolve:t.helps_resolve,requires_deselect:t.requires_deselect,blocked_by:t.blocked_by}))}}return{selected:s,available:n,disabled:!1,reason:a,isRequired:r,impact:l,helpsResolve:c,status:d,requiresDeselect:u,blockedBy:h,canSelect:p,selectionMethod:g,requirementTooltip:v}}(Q(a)))),l=we((()=>n?"single":"multiple")),c=we((()=>`group-${t.group.id}`));!function(e,t){ue(t,!0);let s=te(t,"selected",3,!1),i=te(t,"disabled",3,!1),o=te(t,"available",3,!0),n=te(t,"unavailableReason",3,null),a=te(t,"isRequired",3,!1),r=te(t,"selectionType",3,"single"),l=te(t,"groupName",3,null),c=te(t,"impact",3,null),d=te(t,"helpsResolve",19,(()=>[])),u=te(t,"status",3,"selectable");te(t,"requiresDeselect",19,(()=>[]));let h=te(t,"blockedBy",19,(()=>[]));te(t,"canSelect",3,!0),te(t,"selectionMethod",3,"add");let p=te(t,"requirementTooltip",3,null);ee((()=>{"opt_keyboard"!==t.option.id&&"opt_ram_16gb"!==t.option.id&&"opt_ssd_512gb"!==t.option.id||console.log(`OptionCard ${t.option.id}: status=${u()}, impact=${c()}, helpsResolve=`,d())}));const g=we((function(){return"selected"===u()&&h()&&h().length>0?{symbol:"❌",title:`Constraint violation: ${h().map((e=>e.message||e.description)).join("; ")}`,class:"blocked"}:"selected"===u()?null:"switch"===u()&&"single"===r()?"helps"===c()&&d()&&d().length>0?{symbol:"🔄",title:`Switch to resolve: ${d().join(", ")}`,class:"switch-helps"}:{symbol:"🔄",title:"Switch selection",class:"switch"}:"blocked"===u()?{symbol:"❌",title:h()&&h().length>0?h().map((e=>e.message||e.description)).join("; "):n()||"Cannot select due to constraints",class:"blocked"}:null}));var v=Ze();let m;var f=re(v);ce(f,1,"option-label svelte-1hikx0i",null,{},{disabled:!1});var y=re(f);y.disabled=!1,y.__change=[Ve,u,r,t,s,a];var _=oe(y,2);let b;var w=re(_),S=e=>{const s=we((()=>`Helps resolve: ${d().join(", ")}`));Ge(e,{get content(){return Q(s)},position:"top",children:(e,s)=>{var i=Be(),o=ge(i),n=oe(o),a=e=>{var s=Ue(),i=re(s);ne((e=>le(i,`(+$${e??""})`)),[()=>t.option.base_price.toFixed(2)]),ae(e,s)};ie(n,(e=>{t.option.base_price&&t.option.base_price>0&&e(a)})),ne((()=>le(o,`${t.option.name??""} `))),ae(e,i)},$$slots:{default:!0}})},I=(e,s)=>{var i=e=>{Ge(e,{get content(){return p()},position:"top",children:(e,s)=>{var i=Je(),o=ge(i),n=oe(o),a=e=>{var s=Ne(),i=re(s);ne((e=>le(i,`(+$${e??""})`)),[()=>t.option.base_price.toFixed(2)]),ae(e,s)};ie(n,(e=>{t.option.base_price&&t.option.base_price>0&&e(a)})),ne((()=>le(o,`${t.option.name??""} `))),ae(e,i)},$$slots:{default:!0}})},o=e=>{var s=Ke(),i=ge(s),o=oe(i),n=e=>{var s=He(),i=re(s);ne((e=>le(i,`(+$${e??""})`)),[()=>t.option.base_price.toFixed(2)]),ae(e,s)};ie(o,(e=>{t.option.base_price&&t.option.base_price>0&&e(n)})),ne((()=>le(i,`${t.option.name??""} `))),ae(e,s)};ie(e,(e=>{p()&&!Q(g)?e(i):e(o,!1)}),s)};ie(w,(e=>{"helps"===c()&&d()&&d().length>0?e(S):e(I,!1)}));var k=oe(w,2),O=e=>{var t=Qe();ae(e,t)};ie(k,(e=>{a()&&!s()&&e(O)}));var $=oe(k,2),q=e=>{Ge(e,{get content(){return Q(g).title},position:"top",children:(e,t)=>{var s=Xe(),i=re(s);ne((()=>{ce(s,1,`impact-marker ${Q(g).class??""}`,"svelte-1hikx0i"),le(i,Q(g).symbol)})),ae(e,s)},$$slots:{default:!0}})};ie($,(e=>{Q(g)&&e(q)}));var A=oe(f,2),R=e=>{var t=Ye(),s=re(t);ne((()=>le(s,n()))),ae(e,t)};ie(A,(e=>{o()&&!i()||!n()||s()||e(R)})),ne(((e,t)=>{m=ce(v,1,"option-item svelte-1hikx0i",null,m,e),Se(y,"type","single"===r()?"radio":"checkbox"),Se(y,"name","single"===r()&&l()?l():void 0),Ie(y,s()),b=ce(_,1,"option-text svelte-1hikx0i",null,b,t)}),[()=>({unavailable:!o()&&!s()}),()=>({"helps-resolve":"helps"===c(),"has-requirements":p()&&!Q(g),"has-violations":"selected"===u()&&h()&&h().length>0})]),ae(e,v),ve()}(e,{get option(){return Q(a)},get selected(){return Q(r).selected},get disabled(){return Q(r).disabled},get available(){return Q(r).available},get unavailableReason(){return Q(r).reason},get isRequired(){return Q(r).isRequired},get impact(){return Q(r).impact},get helpsResolve(){return Q(r).helpsResolve},get status(){return Q(r).status},get requiresDeselect(){return Q(r).requiresDeselect},get blockedBy(){return Q(r).blockedBy},get canSelect(){return Q(r).canSelect},get selectionMethod(){return Q(r).selectionMethod},get selectionType(){return Q(l)},get groupName(){return Q(c)},get requirementTooltip(){return Q(r).requirementTooltip},onChange:e=>function(e,a){const r=a>0?1:0;if(n&&r>0){const a=o().find((t=>t.option&&t.option.id===e||t.id===e));if(a&&"switch"===a.status&&a.requires_deselect)for(const e of a.requires_deselect)t.onSelectionChange&&t.onSelectionChange(e,0);else if(n)for(const o of s())o.id!==e&&i()&&i()[o.id]>0&&t.onSelectionChange&&t.onSelectionChange(o.id,0)}t.onSelectionChange&&t.onSelectionChange(e,r)}(Q(a).id,e)})})),ne(((e,t)=>{l=ce(r,1,"option-group svelte-1m3fy32",null,l,e),le(u,`${t??""} `)}),[()=>({"radio-group":n}),()=>Ce(t.group.name)]),ae(e,r),ve()}var ot=se('<div class="calculating svelte-yx8kte"><!> <span>Calculating price...</span></div>'),nt=se('<div class="empty-pricing svelte-yx8kte"><p>No options selected</p></div>'),at=se('<div class="price-item svelte-yx8kte"><span class="item-name svelte-yx8kte"> </span> <span class="item-price svelte-yx8kte"> </span></div>'),rt=se('<div class="discount-item svelte-yx8kte"><span class="discount-name svelte-yx8kte"> </span> <span class="discount-amount svelte-yx8kte"> </span></div>'),lt=se('<div class="discounts-section svelte-yx8kte"><h4 class="section-label svelte-yx8kte">Discounts Applied:</h4> <!></div>'),ct=se('<div class="selected-items svelte-yx8kte"><h4 class="section-label svelte-yx8kte">Selected Options:</h4> <!></div> <!> <div class="total-section svelte-yx8kte"><span class="total-label svelte-yx8kte">Total Price:</span> <span class="total-amount svelte-yx8kte"> </span></div>',1),dt=se('<div class="pricing-display svelte-yx8kte"><!></div>');var ut=se('<p class="empty-state svelte-1vgnof6">No options selected yet</p>'),ht=se('<span class="item-price svelte-1vgnof6"> </span>'),pt=se('<div class="summary-item svelte-1vgnof6"><span class="item-name svelte-1vgnof6"> </span> <!></div>'),gt=se('<div class="compact-list svelte-1vgnof6"></div> <div class="summary-total svelte-1vgnof6"><span>Total:</span> <span class="total-price svelte-1vgnof6"> </span></div>',1),vt=se('<span class="status-badge valid svelte-1vgnof6">✅ Valid</span>'),mt=se('<span class="status-badge invalid svelte-1vgnof6">⚠️ Issues</span>'),ft=se('<div class="summary-header svelte-1vgnof6"><div class="header-info svelte-1vgnof6"><h3 class="svelte-1vgnof6">Configuration Summary</h3> <p class="config-id svelte-1vgnof6"> </p></div> <div class="header-status"><!></div></div>'),yt=se('<span class="option-sku svelte-1vgnof6"> </span>'),_t=se('<span class="quantity svelte-1vgnof6"> </span>'),bt=se('<span class="price svelte-1vgnof6"> </span>'),wt=se('<span class="included svelte-1vgnof6">Included</span>'),St=se('<div class="option-row svelte-1vgnof6"><div class="option-details svelte-1vgnof6"><span class="option-name svelte-1vgnof6"> </span> <!></div> <div class="option-pricing svelte-1vgnof6"><!> <!></div></div>'),It=se('<div class="group-section svelte-1vgnof6"><h5 class="group-name svelte-1vgnof6"> </h5> <!></div>'),kt=se('<span class="affected-options svelte-1vgnof6"> </span>'),Ot=se('<div class="violation-item svelte-1vgnof6"><span class="violation-message svelte-1vgnof6"> </span> <!></div>'),$t=se('<div class="violations-section svelte-1vgnof6"><h4 class="section-title svelte-1vgnof6"> </h4> <!></div>'),qt=se('<div class="suggestion-item svelte-1vgnof6"><span class="suggestion-name svelte-1vgnof6"> </span> <span class="helps-resolve svelte-1vgnof6"> </span></div>'),At=se('<div class="suggestions-section svelte-1vgnof6"><h4 class="section-title svelte-1vgnof6">💡 Suggested Options</h4> <p class="suggestion-intro svelte-1vgnof6">These options can help resolve configuration issues:</p> <!></div>'),Rt=se('<div class="full-summary svelte-1vgnof6"><!> <div class="selections-section svelte-1vgnof6"><h4 class="section-title svelte-1vgnof6"> </h4> <!></div> <!> <!> <div class="summary-footer svelte-1vgnof6"><div class="total-row svelte-1vgnof6"><span class="total-label svelte-1vgnof6">Configuration Total</span> <span class="total-amount svelte-1vgnof6"> </span></div></div></div>'),Ct=se("<div><!></div>");function xt(e,t){ue(t,!0);let s=te(t,"selections",19,(()=>({}))),i=te(t,"options",19,(()=>[])),o=te(t,"groups",19,(()=>[])),n=te(t,"compact",3,!1),a=te(t,"configuration",3,null);te(t,"model",3,null);let r=te(t,"validationResults",3,null),l=te(t,"constraintSummary",3,null);te(t,"onEdit",3,null);const c=we((()=>i().filter((e=>s()[e.id]>0)).map((e=>({...e,quantity:s()[e.id],group:o().find((t=>t.id===e.group_id))}))).sort(((e,t)=>(e.group_id||"").localeCompare(t.group_id||""))))),d=we((()=>Q(c).reduce(((e,t)=>e+(t.base_price||0)*t.quantity),0))),u=we((()=>Q(c).reduce(((e,t)=>{const s=t.group?.name||"Other Options";return e[s]||(e[s]=[]),e[s].push(t),e}),{})));var h=Ct();let p;var g=re(h),v=e=>{var t=ut();ae(e,t)},m=(e,t)=>{var s=e=>{var t=gt(),s=ge(t);ke(s,21,(()=>Q(c)),$e,((e,t)=>{var s=pt(),i=re(s),o=re(i),n=oe(i,2),a=e=>{var s=ht(),i=re(s);ne((e=>le(i,`+$${e??""}`)),[()=>Q(t).base_price.toFixed(2)]),ae(e,s)};ie(n,(e=>{Q(t).base_price>0&&e(a)})),ne((e=>le(o,e)),[()=>Ce(Q(t).name)]),ae(e,s)}));var i=oe(s,2),o=oe(re(i),2),n=re(o);ne((e=>le(n,`$${e??""}`)),[()=>Q(d).toFixed(2)]),ae(e,t)},i=e=>{var t=Rt(),s=re(t),i=e=>{var t=ft(),s=re(t),i=oe(re(s),2),o=re(i),n=oe(s,2),r=re(n),l=e=>{var t=vt();ae(e,t)},c=e=>{var t=mt();ae(e,t)};ie(r,(e=>{a().validation?.is_valid?e(l):e(c,!1)})),ne((()=>le(o,`ID: ${a().id||"Not saved"}`))),ae(e,t)};ie(s,(e=>{a()&&e(i)}));var o=oe(s,2),n=re(o),h=re(n),p=oe(n,2);ke(p,17,(()=>Object.entries(Q(u))),$e,((e,t)=>{var s=we((()=>qe(Q(t),2)));var i=It(),o=re(i),n=re(o),a=oe(o,2);ke(a,17,(()=>Q(s)[1]),$e,((e,t)=>{var s=St(),i=re(s),o=re(i),n=re(o),a=oe(o,2),r=e=>{var s=yt(),i=re(s);ne((()=>le(i,`SKU: ${Q(t).sku??""}`))),ae(e,s)};ie(a,(e=>{Q(t).sku&&e(r)}));var l=oe(i,2),c=re(l),d=e=>{var s=_t(),i=re(s);ne((()=>le(i,`${Q(t).quantity??""}x`))),ae(e,s)};ie(c,(e=>{Q(t).quantity>1&&e(d)}));var u=oe(c,2),h=e=>{var s=bt(),i=re(s);ne((e=>le(i,`$${e??""}`)),[()=>(Q(t).base_price*Q(t).quantity).toFixed(2)]),ae(e,s)},p=e=>{var t=wt();ae(e,t)};ie(u,(e=>{Q(t).base_price>0?e(h):e(p,!1)})),ne((e=>le(n,e)),[()=>Ce(Q(t).name)]),ae(e,s)})),ne((()=>le(n,Q(s)[0]))),ae(e,i)}));var g=oe(o,2),v=e=>{var t=$t(),s=re(t),i=re(s),o=oe(s,2);ke(o,17,(()=>r().violations),$e,((e,t)=>{var s=Ot(),i=re(s),o=re(i),n=oe(i,2),a=e=>{var s=kt(),i=re(s);ne((e=>le(i,`Affects: ${e??""}`)),[()=>Q(t).affected_options.join(", ")]),ae(e,s)};ie(n,(e=>{Q(t).affected_options&&Q(t).affected_options.length>0&&e(a)})),ne((()=>le(o,Q(t).message))),ae(e,s)})),ne((()=>le(i,`⚠️ Configuration Issues (${r().violations.length??""})`))),ae(e,t)};ie(g,(e=>{r()&&r().violations&&r().violations.length>0&&e(v)}));var m=oe(g,2),f=e=>{var t=At(),s=oe(re(t),4);ke(s,17,(()=>l().helpfulOptions),$e,((e,t)=>{var s=qt(),i=re(s),o=re(i),n=oe(i,2),a=re(n);ne((e=>{le(o,Q(t).name),le(a,`Resolves: ${e??""}`)}),[()=>Q(t).helpsResolve.join(", ")]),ae(e,s)})),ae(e,t)};ie(m,(e=>{l()&&l().helpfulOptions&&l().helpfulOptions.length>0&&e(f)}));var y=oe(m,2),_=re(y),b=oe(re(_),2),w=re(b);ne((e=>{le(h,`Selected Options (${Q(c).length??""})`),le(w,`$${e??""}`)}),[()=>Q(d).toFixed(2)]),ae(e,t)};ie(e,(e=>{n()?e(s):e(i,!1)}),t)};ie(g,(e=>{0===Q(c).length?e(v):e(m,!1)})),ne((e=>p=ce(h,1,"configuration-summary svelte-1vgnof6",null,p,e)),[()=>({compact:n()})]),ae(e,h),ve()}var Tt=se('<div class="loading-state svelte-1js0sg2"><!> <p>Initializing configurator...</p></div>'),Mt=se('<div class="error-state svelte-1js0sg2"><h2 class="svelte-1js0sg2">Unable to Load Configuration</h2> <p class="svelte-1js0sg2"> </p> <button class="btn-retry svelte-1js0sg2">Try Again</button></div>'),Dt=se('<div class="loading-state svelte-1js0sg2"><!> <p>Loading configuration options...</p></div>'),Et=se('<div class="error-state svelte-1js0sg2"><h2 class="svelte-1js0sg2">Model Not Found</h2> <p class="svelte-1js0sg2">The requested configuration model could not be loaded.</p></div>'),jt=se('<div class="debug-info svelte-1js0sg2"><details><summary class="svelte-1js0sg2">Debug: Store State</summary> <pre class="svelte-1js0sg2"> </pre></details></div>'),Pt=se('<p class="model-description svelte-1js0sg2"> </p>'),Wt=se('<button class="extend-btn svelte-1js0sg2">Extend</button>'),zt=se('<span class="session-expiry svelte-1js0sg2"> </span> <!>',1),Ft=se('<div class="session-info svelte-1js0sg2"><span> </span> <!> <button class="clear-session-btn svelte-1js0sg2" title="Clear session and start over">Clear Session</button></div>'),Lt=se('<div class="session-info svelte-1js0sg2"><span class="config-id svelte-1js0sg2"> </span> <button class="clear-session-btn svelte-1js0sg2" title="Clear configuration and start over">Start New Configuration</button></div>'),Gt=se('<p class="empty-state svelte-1js0sg2">No configuration groups available.</p>'),Vt=se("<!> <span>Saving...</span>",1),Ut=se("<span> </span>"),Bt=se('<button class="btn-secondary svelte-1js0sg2">Clear All</button>'),Nt=se('<p class="help-text svelte-1js0sg2">Resolve validation errors to continue</p>'),Jt=se('<div class="configurator-layout svelte-1js0sg2"><!> <header class="configurator-header svelte-1js0sg2"><div class="header-content svelte-1js0sg2"><h1 class="svelte-1js0sg2"> </h1> <!></div> <!> <!></header> <div class="configurator-body svelte-1js0sg2"><div class="options-column svelte-1js0sg2"><h2 class="column-title svelte-1js0sg2">Configuration Options</h2> <!></div> <div class="info-column svelte-1js0sg2"><div class="info-section svelte-1js0sg2"><h3 class="svelte-1js0sg2">Configuration Summary</h3> <!> <!> <div class="actions-section svelte-1js0sg2"><button class="btn-primary svelte-1js0sg2"><!></button> <!> <!></div></div></div></div></div>'),Ht=se("<div><!></div>");function Kt(e,t){ue(t,!0);let s=te(t,"theme",3,"light"),i=te(t,"apiUrl",3,"/api/v1"),o=te(t,"embedMode",3,!1),n=te(t,"onComplete",3,null),a=te(t,"configurationId",3,null),r=te(t,"useSessionApi",3,!1),l=Y(!1),c=r()?new De:Te;"undefined"!=typeof window&&(window.__API_BASE_URL__=i());const d=we((()=>Array.isArray(c.groups)?c.groups.filter((e=>!1!==e.is_active)):[])),u=we((()=>c.model&&c.groups&&c.options&&null!==c.selections&&void 0!==c.selections&&Object.keys(c.selections).length>=0)),h=we((()=>c.isValid&&c.selectedCount>0)),p=we((()=>r()?{status:c.sessionStatus,timeRemaining:c.sessionTimeRemaining,sessionId:c.sessionId}:null));async function g(){if(!c.isSaving)if(r())await c.completeSession(),n()&&n()({sessionId:c.sessionId,selections:c.selections,totalPrice:c.totalPrice,isValid:c.isValid});else{await c.saveConfiguration()&&n()&&n()(c.exportConfiguration())}}async function v(){r()&&c.extendSession&&await c.extendSession(30)}function m(){"undefined"!=typeof localStorage&&(localStorage.removeItem("session_id"),localStorage.removeItem("session_token"),localStorage.removeItem("auth_token")),c.reset(),r()?c.initialize(t.modelId,{authToken:null}):c.setModelId(t.modelId)}function f(){c.error=null,r()?c.initialize(t.modelId,{authToken:localStorage.getItem("auth_token")}):c.loadModel()}ee((()=>{r()&&(console.log("Session Store State:",{groups:c.groups,options:c.options,model:c.model,visibleGroups:Q(d),sessionId:c.sessionId,isValid:c.isValid,validationResult:c.validationResult,selections:c.selections,selectionCount:Object.keys(c.selections||{}).length,timestamp:(new Date).toISOString()}),c.groups&&c.selections&&c.groups.forEach((e=>{if(e.default_option_id){const t=c.selections[e.default_option_id]>0;console.log(`Group ${e.name}: default=${e.default_option_id}, selected=${t}`)}})))})),he((async()=>{r()?await c.initialize(t.modelId,{authToken:localStorage.getItem("auth_token")}):(await c.initialize(),c.setModelId(t.modelId),a()&&await c.loadConfiguration(a())),X(l,!0),document.documentElement.setAttribute("data-theme",s())}));var y=Ht();let _;!function(e,t){ue(t,!0);let s=te(t,"fallback",3,null),i=te(t,"onError",3,null),o=Y(null),n=Y(!1);function a(e){console.error("ErrorBoundary caught:",e.error),X(o,e.error,!0),X(n,!0),i()&&i()(e.error),e.preventDefault(),e.stopPropagation()}function r(){X(o,null),X(n,!1)}he((()=>(window.addEventListener("error",a),window.addEventListener("unhandledrejection",(e=>{a({error:e.reason})})),()=>{window.removeEventListener("error",a),window.removeEventListener("unhandledrejection",a)})));var l=pe(),c=ge(l),d=e=>{var t=pe(),i=ge(t),n=e=>{var t=pe(),i=ge(t);me(i,s,(()=>Q(o)),(()=>r)),ae(e,t)},a=e=>{var t=ze(),s=re(t),i=oe(re(s),4),n=re(i),a=oe(i,2);ie(a,(e=>{}));var l=oe(a,2),c=re(l);c.__click=r,oe(c,2).__click=[We],ne((()=>le(n,Q(o)?.message||"An unexpected error occurred"))),ae(e,t)};ie(i,(e=>{s()?e(n):e(a,!1)})),ae(e,t)},u=e=>{var s=pe(),i=ge(s);me(i,(()=>t.children)),ae(e,s)};ie(c,(e=>{Q(n)?e(d):e(u,!1)})),ae(e,l),ve()}(re(y),{children:(e,t)=>{var s=pe(),i=ge(s),o=e=>{var t=Tt();Pe(re(t),{size:"large"}),ae(e,t)},n=(e,t)=>{var s=e=>{var t=Mt(),s=oe(re(t),2),i=re(s);oe(s,2).__click=f,ne((()=>le(i,c.error.message||"Something went wrong"))),ae(e,t)},i=(e,t)=>{var s=e=>{var t=Dt();Pe(re(t),{size:"large"}),ae(e,t)},i=(e,t)=>{var s=e=>{var t=Et();ae(e,t)},i=e=>{var t=Jt(),s=re(t),i=e=>{var t=jt(),s=re(t),i=oe(re(s),2),o=re(i);ne((e=>le(o,e)),[()=>JSON.stringify({selections:c.selections,selectionCount:c.selectedCount,groupsWithDefaults:c.groups?.filter((e=>e.default_option_id)).map((e=>({name:e.name,defaultOptionId:e.default_option_id,isSelected:c.selections&&c.selections[e.default_option_id]>0})))},null,2)]),ae(e,t)};ie(s,(e=>{"localhost"===window.location.hostname&&e(i)}));var o=oe(s,2),n=re(o),a=re(n),l=re(a),u=oe(a,2),f=e=>{var t=Pt(),s=re(t);ne((()=>le(s,c.model.description))),ae(e,t)};ie(u,(e=>{c.model.description&&e(f)}));var y=oe(n,2),_=e=>{var t=Ft(),s=re(t),i=re(s),o=oe(s,2),n=e=>{var t=zt(),s=ge(t),i=re(s),o=oe(s,2),n=e=>{var t=Wt();t.__click=v,ae(e,t)};ie(o,(e=>{("1 days"===Q(p).timeRemaining||Q(p).timeRemaining.includes("hours"))&&e(n)})),ne((()=>le(i,`Expires in: ${Q(p).timeRemaining??""}`))),ae(e,t)};ie(o,(e=>{Q(p).timeRemaining&&e(n)})),oe(o,2).__click=m,ne((()=>{ce(s,1,`session-status ${Q(p).status??""}`,"svelte-1js0sg2"),le(i,Q(p).status)})),ae(e,t)};ie(y,(e=>{Q(p)&&e(_)}));var b=oe(y,2),w=e=>{var t=Lt(),s=re(t),i=re(s);oe(s,2).__click=m,ne((()=>le(i,`Config ID: ${c.configurationId??""}`))),ae(e,t)};ie(b,(e=>{!Q(p)&&c.configurationId&&e(w)}));var S=oe(o,2),I=re(S),k=oe(re(I),2),O=e=>{var t=Gt();ae(e,t)},$=e=>{var t=pe(),s=ge(t);ke(s,17,(()=>Q(d)),(e=>e.id),((e,t)=>{const s=we((()=>c.options?.filter((e=>e.group_id===Q(t).id&&!1!==e.is_active))||[])),i=we((()=>c.availableOptions||[])),o=we((()=>r()?c.validationResult:c.validationResults));it(e,{get group(){return Q(t)},get options(){return Q(s)},get selections(){return c.selections},get availableOptions(){return Q(i)},get validationResults(){return Q(o)},onSelectionChange:(e,t)=>c.updateSelection(e,t)})})),ae(e,t)};ie(k,(e=>{0===Q(d).length?e(O):e($,!1)}));var q=oe(I,2),A=re(q),R=oe(re(A),2);const C=we((()=>c.selections||{})),x=we((()=>c.options||[])),T=we((()=>c.groups||[])),M=we((()=>r()?c.validationResult:c.validationResults)),D=we((()=>"function"==typeof c.getConstraintSummary?c.getConstraintSummary():null));xt(R,{get selections(){return Q(C)},get options(){return Q(x)},get groups(){return Q(T)},compact:!1,get configuration(){return c.configuration},get validationResults(){return Q(M)},get constraintSummary(){return Q(D)}});var E=oe(R,2);const j=we((()=>r()?c.pricingResult:c.pricingData)),P=we((()=>c.isPricing||!1)),W=we((()=>c.selections||{})),z=we((()=>c.options||[]));!function(e,t){ue(t,!0);let s=te(t,"pricing",3,null),i=te(t,"isCalculating",3,!1),o=te(t,"selections",19,(()=>({}))),n=te(t,"options",19,(()=>[])),a=we((()=>Array.isArray(n())?Object.entries(o()||{}).filter((([e,t])=>t>0)).map((([e])=>n().find((t=>t.id===e)))).filter(Boolean):[])),r=we((()=>Q(a)?.reduce(((e,t)=>e+(t.price||t.base_price||0)),0)||0)),l=we((()=>s()?.total||s()?.breakdown?.total_price||Q(r)));var c=dt(),d=re(c),u=e=>{var t=ot();Pe(re(t),{size:"small"}),ae(e,t)},h=(e,t)=>{var i=e=>{var t=nt();ae(e,t)},o=e=>{var t=ct(),i=ge(t),o=oe(re(i),2);ke(o,17,(()=>Q(a)),(e=>e.id),((e,t)=>{var s=at(),i=re(s),o=re(i),n=oe(i,2),a=re(n);ne((e=>{le(o,Q(t).name),le(a,`$${e??""}`)}),[()=>(Q(t).price||Q(t).base_price||0).toFixed(2)]),ae(e,s)}));var n=oe(i,2),r=e=>{var t=lt(),i=oe(re(t),2);ke(i,17,(()=>s().breakdown.adjustments),$e,((e,t)=>{var s=pe(),i=ge(s),o=e=>{var s=rt(),i=re(s),o=re(i),n=oe(i,2),a=re(n);ne((e=>{le(o,Q(t).description||Q(t).rule_name),le(a,`-$${e??""}`)}),[()=>Math.abs(Q(t).amount).toFixed(2)]),ae(e,s)};ie(i,(e=>{Q(t).amount<0&&e(o)})),ae(e,s)})),ae(e,t)};ie(n,(e=>{s()?.breakdown?.adjustments&&s().breakdown.adjustments.length>0&&e(r)}));var c=oe(n,2),d=oe(re(c),2),u=re(d);ne((e=>le(u,`$${e??""}`)),[()=>Q(l).toFixed(2)]),ae(e,t)};ie(e,(e=>{0===Q(a).length?e(i):e(o,!1)}),t)};ie(d,(e=>{i()?e(u):e(h,!1)})),ae(e,c),ve()}(E,{get pricing(){return Q(j)},get isCalculating(){return Q(P)},get selections(){return Q(W)},get options(){return Q(z)}});var F=oe(E,2),L=re(F);L.__click=g;var G=re(L),V=e=>{var t=Vt();Pe(ge(t),{size:"small"}),ae(e,t)},U=e=>{var t=Ut(),s=re(t);ne((()=>le(s,r()?"Complete Configuration":"Save Configuration"))),ae(e,t)};ie(G,(e=>{c.isSaving?e(V):e(U,!1)}));var B=oe(L,2),N=e=>{var t=Bt();t.__click=()=>c.reset(),ae(e,t)};ie(B,(e=>{c.selectedCount>0&&e(N)}));var J=oe(B,2),H=e=>{var t=Nt();ae(e,t)};ie(J,(e=>{!Q(h)&&c.selectedCount>0&&e(H)})),ne((()=>{le(l,c.model.name),L.disabled=!Q(h)||c.isSaving||r()&&"completed"===Q(p)?.status})),ae(e,t)};ie(e,(e=>{c.model?e(i,!1):e(s)}),t)};ie(e,(e=>{c.isLoading||!Q(u)?e(s):e(i,!1)}),t)};ie(e,(e=>{c.error?e(s):e(i,!1)}),t)};ie(i,(e=>{Q(l)?e(n,!1):e(o)})),ae(e,s)},$$slots:{default:!0}}),ne((e=>{_=ce(y,1,"configurator-app svelte-1js0sg2",null,_,e),Se(y,"data-theme",s())}),[()=>({"embed-mode":o()})]),ae(e,y),ve()}de(["click"]);export{Kt as C,Te as c};
//# sourceMappingURL=configurator-DlJs7YFV.js.map
